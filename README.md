# BRRO Compressor

## Description
**BRRO Compressor** is an advanced signal-based compression tool designed to provide better compression ratios than traditional methods. It performs an initial analysis of the input signal to select the best compression technique for each segment.

For detailed information on the compression methods used, see [BRRO.md](paper/BRRO.md).

## Major Changes
### Version 0.5 - Released 30/11/2023
- Added Polynomial Compressor (with 2 variants).
- Introduced `wbro` file type.
- Added benchmarks for various compressors.
- Integration testing implemented.
- Various fixes and code cleanups.

## Getting Started
### Prerequisites
- Install Rust and Cargo on your system.

### Installation
1. Clone the repository:
    ```bash
    git clone https://github.com/instaclustr/fft-compression
    cd fft-compression
    ```
2. Build the project:
    ```bash
    cargo build --release
    ```

## Usage
BRRO Compressor currently requires raw BRRO files generated by a Prometheus remote endpoint as input.

### Command-Line Options
```
Usage: brro-compressor [OPTIONS] <INPUT>

Arguments:
  <INPUT>  Input file

Options:
      --compressor <COMPRESSOR>
          Select a compressor, default is auto [default: auto] [possible values: auto, noop, fft, constant, polynomial, idw]
  -e, --error <ERROR>
          Sets the maximum allowed error for the compressed data, must be between 0 and 50. Default is 5 (5%). 0 is lossless compression 50 will do a median filter on the data. In between will pick optimize for the error [default: 5]
  -u
          Uncompresses the input file/directory
  -c, --compression-selection-sample-level <COMPRESSION_SELECTION_SAMPLE_LEVEL>
          Samples the input data instead of using all the data for selecting the optimal compressor. Only impacts speed, might or not increased compression ratio. For best results use 0 (default). Only works when compression = Auto. 0 will use all the data (slowest) 6 will sample 128 data points (fastest) [default: 0]
      --verbose
          Verbose output, dumps everysample in the input file (for compression) and in the ouput file (for decompression)
  -h, --help
          Print help
  -V, --version
          Print version
```

### Compress a File
To compress a file using the BRRO Compressor, run:
```bash
brro-compressor <input-file>
```

### Decompress a File
To decompress a file, use:
```bash
brro-compressor -u <input-file>
```

## Programs and Descriptions

Requires a Prometheus server to collect samples. Supports read and write operations with Prometheus.

Example configuration:
```yaml
# Remote read and Write
remote_write:
  - url: "http://localhost:9201/api/write"

remote_read:
  - url: "http://localhost:9201/api/read"
    read_recent: true
    name: "flac_server"
```
Add the Prometheus server as a data source in Grafana to visualize the data.

## Roadmap
- Update `flac-server` to support reading and writing WBRO/BRO files.
- Implement streaming compression/decompression.
- Introduce automated compressor selection.
- Implement frame expansion (allowing new data to be appended to existing frames).

## Contributing
Please see [CONTRIBUTING.md](CONTRIBUTING.md) for contribution guidelines.

## License
This project is licensed under the [Apache License](LICENSE).