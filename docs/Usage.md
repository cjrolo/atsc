# Usage

Quick objectives, get the repo to compile, understand the optimizer (just run it against some files), FLAC some files, compare results.

## Code

Code was merged. No more branches and all you need is in the master branch.

### flac-server

Needs a prometheus server. We need it to get our samples out. Supports read and write from prometheus.

### brro_optimizer

Maybe the most important tool at this point, it picks a WAV file from the datasets described below and optimizes it into a way that we might see a meaning full compression into FLAC.
The tool also has options to dump the output of the file as a single sample per period, instead of the 4 channels. This is good to obtain the data as it was feed into the flac-server.
The documentation also states that the dump flags (`dump-raw` and `dump-optimized`) write content to a file, *THAT IS A LIE!*. It writes to `stdout` so, if you're using the July data, *REDIRECT IT INTO A FILE!*.
The code performs optimizations based on file name, so renaming might cause issues.

Usage (Getting raw samples): `./brro_optimizer infile.wav --dump-raw > file.raw`
Usage (Getting optimized samples): `./brro_optimizer infile.wav --dump-optimized > file.raw`
Usage (Generate a optimized file): `./brro_optimizer -w infile.wav`

If you set the ENV Variable for Debug it will output what it is doing.

### Matlab folder

This code is *NOT* structured, I put it there to just be safe in case my laptop exploded. It is very random, very buggy, but feel 100% free in exploring and looking into it.
All of the code there, is not converted to Rust, this was done in a posterior phase to speed up prototyping. It will eventually need to be converted if we find anything usefull out of it.

## Data files

PS: Contact me for the data files.

Data is generated by the flac-server. As you explore the codebase you will see that the data are flat WAV files (and a specific Index files, look in the code VSRI files to learn more about that).
The WAV files contain 4 channels with 16bit samples each. This is because prometheus always generate float 64bit samples. Since WAV doesn't support neither 64bit samples, neither float the idea to store RAW data before processing was to split the 64bit into 4x16bit. And send each part to a different channel.

There is 0 processing on any of these WAV files. You can compress them into different formats (At this stage, lossess only, otherwise you will get trash when decompression) and check if you get any decent compression. In some you will do, other not so much!

Recommended tool for compression: SoX (Old but good!) https://sox.sourceforge.net/soxformat.html

How to use it: `sox file.wav file.flac` (yes, is that simple!)

### flac-server-data-july

This is a LOT of signals collected over 7 days. Sampling rate 20s per sample

### flac-server-data-september

Smaller subset, doesn't include prometheus self-monitoring, less than 1-day.
Sampling Rate 10s per sample.
